### 环境准备：

环境搭建时相关版本如下：

dubbo的版本为：dubbo-3.3.5-add-more-logging（基于tag:dubbo-3.3.5日志增强版本）

JDK版本：17

maven版本：3.9.11

gradle版本：8.14.3

spring版本：v6.2.7-add-more-logging（基于tag:v6.2.7日志增强版本）

zookeeper版本：3.9.3

dubbo admin版本：0.6.0-release

### 一.ubuntu中JDK安装

（1）下载bellsoft-jdk17.0.16，选择FULL JDK（Spring源码构建时依赖该JDK，其基于OPENJDK）：https://bell-sw.com/pages/downloads/#jdk-17-lts

    https://download.bell-sw.com/java/17.0.16+12/bellsoft-jdk17.0.16+12-linux-amd64-full.tar.gz
    https://download.bell-sw.com/java/21.0.8+12/bellsoft-jdk21.0.8+12-linux-amd64-full.tar.gz

（2）ubuntu中JDK多版本下使用：

（2.1）克隆jenv：git clone https://github.com/jenv/jenv.git ~/.jenv

（2.2）配置环境：

    echo 'export PATH="$HOME/.jenv/bin:$PATH"' >> ~/.bashrc
    echo 'eval "$(jenv init -)"' >> ~/.bashrc

（2.3）使.bashrc修改生效：source ~/.bashrc

（2.4）jenv加入jdk的管理：

    tar -xzvf bellsoft-jdk17.0.16+12-linux-amd64-full.tar.gz
    tar -xzvf bellsoft-jdk21.0.8+12-linux-amd64-full.tar.gz
    jenv add /usr/lib/jvm/jdk-17.0.16-full
    jenv add /usr/lib/jvm/jdk-21.0.8-full
    备注：jdk21在spring源码构建时会用到

（2.5）切换JDK版本：jenv global 17


### 二.ubuntu中maven安装（dubbo使用）

（1）maven下载地址：https://dlcdn.apache.org/maven/maven-3/3.9.11/binaries/apache-maven-3.9.11-bin.zip

    修改apache-maven-3.9.11/conf/settings.xml,添加阿里云镜像源，以提高构建速度：
    <mirror>
    	<id>nexus-aliyun</id>
    	<mirrorOf>central</mirrorOf>
    	<name>Nexus aliyun</name>
    	<url>https://maven.aliyun.com/nexus/content/groups/public</url>
    </mirror>


（2）ubuntu中maven多版本下使用：

（2.1）maven加入update-alternatives的管理：sudo update-alternatives --install /usr/bin/mvn mvn /path/to/your/apache-maven-3.9.11/bin/mvn 3911

（2.2）选择maven版本，输入选择这一列的编号：sudo update-alternatives --config mvn

### 三.ubuntu中安装gradle

（1）安装gradle

（1.1）方式一：通过SDKMAN，直接安装：
    
    curl -s "https://get.sdkman.io" | bash
    source "$HOME/.sdkman/bin/sdkman-init.sh"
    sdk list gradle
    sdk install gradle 8.14

（1.2）方式二：通过阿里云镜像下载，https://mirrors.aliyun.com/gradle/distributions/v8.14.0/gradle-8.14-all.zip

    sdk install gradle 8.14 /path/to/your/gradle-8.14-all.zip

（2）配置阿里云镜像，以加速访问：
    
    创建：~/.gradle/init.d/aliyun-mirror.init.gradle.kts，内容如下：
    allprojects {
        buildscript {
            repositories {
                maven { url = uri("https://maven.aliyun.com/repository/public") }
                maven { url = uri("https://maven.aliyun.com/repository/spring") }
                maven { url = uri("https://maven.aliyun.com/repository/gradle-plugin") }
                maven { url = uri("https://maven.aliyun.com/repository/apache-snapshots") }
                maven { url = uri("https://maven.aliyun.com/repository/google") }
                // 保留官方仓库
                mavenCentral()
                gradlePluginPortal()
            }
        }
        repositories {
            maven { url = uri("https://maven.aliyun.com/repository/public") }
            maven { url = uri("https://maven.aliyun.com/repository/spring") }
            maven { url = uri("https://maven.aliyun.com/repository/gradle-plugin") }
            maven { url = uri("https://maven.aliyun.com/repository/apache-snapshots") }
            maven { url = uri("https://maven.aliyun.com/repository/google") }
            mavenCentral()
        }
    }


### 四.IntelliJ IDEA Community Edition下载安装

    下载地址：https://www.jetbrains.com/idea/download/?section=linux
    安装完成后修改配置：
        Gradle user home：~/.gradle
        Build and run using : IntelliJ IDEA
        Run tests using : IntelliJ IDEA
        Distribution：Wrapper
        Gradle JVM：BellSoft Liberica 17.0.16

### 五.spring：日志增强版本，以更好观察dubbo启动和运行过程

（1）在spring官方fork到个人仓库：https://github.com/spring-projects/spring-framework

（2）git clone git@github.com:czwer/spring-framework.git

（3）切到目标tag：git checkout v6.2.7

（4）创建日志增强分支：git checkout -b v6.2.7-add-more-logging

（5）配置gradle：

    cp ~/.sdkman/tmp/gradle-8.14-all.zip /usr/lib/gradle
    修改文件：gradle/wrapper/gradle-wrapper.properties：
        修改该行,指定本地gradle位置：distributionUrl=file:///usr/lib/gradle/gradle-8.14-all.zip
    修改文件：gradle.properties中：
        修改代码构建的版本号：version=6.2.7-add-more-logging
        添加该行，指定JDK安装路径：org.gradle.java.installations.paths=/usr/lib/jvm/jdk-17.0.16-full,/usr/lib/jvm/jdk-21.0.8-full
    修改文件：build.gradle
        声明编码：
            tasks.withType(JavaCompile) {
                options.encoding = 'UTF-8'
            }
        直接排除不需要构建的模块：
            def excludedProjects = [':framework-docs', ':integration-tests', ':spring-core-test']
            gradle.projectsLoaded {
                subprojects.findAll { excludedProjects.forEach {excludedProject->it.name.contains(excludedProject)} }.each {
                    it.tasks.all { task ->
                        task.enabled = false // 禁用该项目的所有任务
                    }
                }
            }

（6）预编译 spring-oxm 模块（必须步骤）：

    ./gradlew :spring-oxm:compileTestJava

（7）完整编译：
    
    方案1：编译并发布到本机.m2方便其它项目使用
        ./gradlew -x test -x javadoc -x dokkaHtmlPartial -x dokkaHtmlMultiModule publishToMavenLocal
    方案2：并行编译（加快速度）
        ./gradlew -x test -x javadoc -x dokkaHtmlPartial -x dokkaHtmlMultiModule publishToMavenLocal --parallel

    编译生成的jar在各个模块中：模块名/build/libs/模块名-6.2.7-add-more-logging.jar

（8）部分编译并发布到本机：

    ./gradlew :spring-core:publishToMavenLocal -x test -x javadoc --parallel

### 六.spring-boot：日志增强版本，以更好观察dubbo启动和运行过程

（1）在spring-boot官方fork到个人仓库：https://github.com/spring-projects/spring-boot

（2）git clone git@github.com:czwer/spring-boot.git

（3）切到目标tag：git checkout v3.5.0

（4）创建日志增强分支：git checkout -b v3.5.0-add-more-logging

    修改原来“3.5.0”版本号为：“v3.5.0-add-more-logging”

（5）修改代码ch.qos.logback.classic.turbo.TurboFilter返回值为：FilterReply.ACCEPT，以打印更多日志。

（6）配置gradle：

    修改文件：gradle/wrapper/gradle-wrapper.properties：
        修改该行,指定本地gradle位置：distributionUrl=file:///usr/lib/gradle/gradle-8.14-all.zip
    修改文件：gradle.properties中：
        修改代码构建的版本号：version=3.5.0-add-more-logging
        修改spring的版本号：springFrameworkVersion=6.2.7-add-more-logging
        添加该行，指定JDK安装路径：org.gradle.java.installations.paths=/usr/lib/jvm/jdk-17.0.16-full,/usr/lib/jvm/jdk-21.0.8-full
    修改文件：buildSrc/build.gradle
        添加该行，引用本地.m2下依赖，repositories中第一个行：mavenLocal()  // 必须放在首位
    修改文件：build.gradle
        添加该行，引用本地.m2下依赖，repositories中第一个行：mavenLocal()  // 必须放在首位
        直接排除不需要构建的模块：
        def excludedProjects = [':spring-boot-docs', ':spring-boot-system-tests', ':spring-boot-tests','dokkatooGenerateModuleHtml','aggregatedJavadoc','dokkatooGeneratePublicationHtml']
        gradle.projectsLoaded {
           subprojects.findAll { excludedProjects.forEach {excludedProject->it.name.contains(excludedProject)} }.each {
                it.tasks.all { task ->
                    task.enabled = false // 禁用该项目的所有任务
                }
            }
        }


（7）完整编译：

    ./gradlew -x runSpringApplicationExample -x runLoggingFormatExample -x runRemoteSpringApplicationExample -x test -x javadoc  -x aggregatedJavadoc -x dokkatooGenerateModuleHtml -x documentationTest -x dokkatooGeneratePublicationHtml publishToMavenLocal --parallel

    编译生成的jar在各个模块中：模块名/build/libs/模块名-6.2.7-add-more-logging.jar


### 七.dubbo：日志增强版本，以更好观察duboo启动和运行过程

（1）在dubbo官方fork到个人仓库：https://github.com/apache/dubbo

（2）git clone git@github.com:czwer/dubbo.git

（3）切到目标tag：git checkout dubbo-3.3.5

（4）创建日志增强分支：git checkout -b dubbo-3.3.5-add-more-logging，新增的日志：“自定义日志---“

    修改文件：dubbo/pom.xml，dubbo-dependencies-bom/pom.xml：
        修改代码构建的版本号：3.3.5-add-more-logging
    修改文件：dubbo/pom.xml：
        修改spring版本：6.2.7-add-more-logging
        修改spring-boot版本：3.5.0-add-more-logging
    修改文件：.mvn\wrapper\maven-wrapper.properties
        #linux
        #distributionUrl=file:///usr/lib/maven/apache-maven-3.9.11-bin.zip
        #windows
        distributionUrl=file:///D:/Development/maven/apache-maven-3.9.11-bin.zip

（5）编译源码：

    跳过所有测试：
        mvn spotless:apply clean install -DskipTests
    或者跳过测试编译和执行：
        linux：
            mvn spotless:apply clean install -Dmaven.test.skip=true
        windows：
            mvn spotless:apply clean install '-Dmaven.test.skip=true'
        或分开执行
        linux：
            mvn spotless:apply
            mvn clean install -Dmaven.test.skip=true
        windows：
            mvn spotless:apply
            mvn clean install '-Dmaven.test.skip=true'
    编译指定模块：
        mvn clean compile -pl dubbo-config -Dmaven.test.skip=true

（6）构建所生成jar位置：
    
    dubbo/dubbo-distribution/dubbo-all/target/dubbo-3.3.5-add-more-logging.jar
    dubbo/dubbo-spring-boot-project/dubbo-spring-boot-starters/dubbo-spring-boot-starter/target/dubbo-spring-boot-starter-3.3.5-add-more-logging.jar
    
### 八.zookeeper安装

（1）zookeeper下载地址：https://dlcdn.apache.org/zookeeper/zookeeper-3.9.4/apache-zookeeper-3.9.4-bin.tar.gz

（2）拷贝配置：cp apache-zookeeper-3.9.4-bin/conf/zoo_sample.cfg apache-zookeeper-3.9.4-bin/conf/zoo.cfg

（3）创建数据目录和日志目录：

    mkdir apache-zookeeper-3.9.4-bin/data
    mkdir apache-zookeeper-3.9.4-bin/logs
（4）修改apache-zookeeper-3.9.3-bin/conf/zoo.cfg：

    dataDir=/path/to/your/apache-zookeeper-3.9.4-bin/data
    dataLogDir=/path/to/your/apache-zookeeper-3.9.4-bin/logs
（5）启动：

（5.1）前台启动：apache-zookeeper-3.9.3-bin/bin/zkServer.sh start-foreground

（5.2）后台启动：apache-zookeeper-3.9.3-bin/bin/zkServer.sh start

### 九.dubbo admin安装

（1）官网：https://github.com/apache/dubbo-admin

（2）dubbo admin下载：git clone https://github.com/apache/dubbo-admin.git

（2.1）切到分支：0.6.0-release

（2.2）修改dubbo-admin/dubbo-admin-server/pom.xml中zookeeper版本：3.7.2

    <groupId>org.apache.zookeeper</groupId>
    <artifactId>zookeeper</artifactId>
    <version>3.7.2</version>

（2.3）maven进行构建： mvn clean install -Dmaven.test.skip=true

（2.4）启动： java -jar dubbo-admin-server-0.6.0.jar

（3）访问地址：http://localhost:38080/#/ ，root/root

### 十.安装Mysql
    Linux查看本机glibc版本，便于选择版本： ldd --version

（1）官网：https://dev.mysql.com/downloads/mysql/

（1.1）下载：
    
    https://cdn.mysql.com//Downloads/MySQL-8.4/mysql-8.4.6-linux-glibc2.28-x86_64.tar.xz
    或
    https://cdn.mysql.com//Downloads/MySQL-9.4/mysql-9.4.0-linux-glibc2.28-x86_64.tar.xz
（1.2）安装

（1.2.1）安装mysql依赖：

    apt search libaio
    sudo apt install libaio1t64
    sudo ln -s /usr/lib/x86_64-linux-gnu/libaio.so.1t64.0.2 /usr/lib/x86_64-linux-gnu/libaio.so.1

（1.2.2）解压：

    tar -xvf mysql-8.4.6-linux-glibc2.28-x86_64.tar.xz
（1.2.3）移动到安装目录：

    sudo mkdir /usr/local/mysql/
    
    sudo mv mysql-8.4.6-linux-glibc2.28-x86_64/ /usr/local/mysql

（1.2.4）设置环境变量：编辑 ~/.bashrc添加如下，编辑完执行：source .bashrc

    export MYSQL_HOME="/usr/local/mysql"
    export PATH="$MYSQL_HOME/bin:$PATH"

（1.2.5）创建用户和用户组

    sudo groupadd mysql
    sudo useradd -r -g mysql -s /bin/false mysql

（1.2.6）创建数据目录：

    sudo mkdir -p /usr/local/mysql/data
    cd /usr/local/mysql
    sudo chown -R mysql:mysql .
    sudo chmod -R 755 .
（1.2.7）配置mysql：
    
    sudo vim /etc/my.cnf
    拷贝以下内容：
        [mysqld]
        bind-address=0.0.0.0
        port=3306
        user=mysql
        basedir=/usr/local/mysql
        datadir=/usr/local/mysql/data
        log-error=/usr/local/mysql/data/mysql.err
        pid-file=/usr/local/mysql/data/mysql.pid
        character_set_server=utf8mb4
        symbolic-links=0
        explicit_defaults_for_timestamp=true
        mysql_native_password=ON
        # 如果需要表名不区分大小写，可以取消下面一行的注释
        # lower_case_table_names=1
        
        [client]
        port=3306
        default-character-set=utf8mb4
（1.2.8）初始化数据库

    sudo bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data
    密码在：/usr/local/mysql/data/mysql.err
（1.2.9）启动mysql服务：
    
    sudo cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
    systemctl status mysql
    systemctl start mysql

（1.2.10）修改root用户密码
    
    /usr/local/mysql/bin/mysql -u root -p
    ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';
    FLUSH PRIVILEGES;
    EXIT;

（1.2.11）验证mysql版本：
    
    mysql -u root -p -e "SELECT VERSION();"

### 十一.安装nginx

（1）官网：https://nginx.org/

（1.1）安装nginx编译依赖：sudo yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel

（1.2）创建用户和用户组：

    sudo groupadd -r nginx
    sudo useradd -r -s /sbin/nologin -g nginx nginx

（1.3）下载nginx源码：wget -c https://nginx.org/download/nginx-1.10.3.tar.gz

（1.4）解压：tar -zxvf nginx-1.10.3.tar.gz

（1.5）配置编译选项：

    ./configure \
    --prefix=/usr/local/nginx \
    --user=nginx \
    --group=nginx \
    --with-http_ssl_module \
    --with-http_stub_status_module

（1.6）编译并安装：make && sudo make install

（1.7）创建软链接：ln -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx

（1.8）mkdir -p /var/log/nginx

（1.9.1）创建服务文件：/usr/lib/systemd/system/nginx.service

    [Unit]
    Description=nginx - high performance web server
    Documentation=http://nginx.org/en/docs/
    After=network-online.target remote-fs.target nss-lookup.target
    Wants=network-online.target
    
    [Service]
    Type=forking
    PIDFile=/var/run/nginx.pid
    ExecStart=/usr/local/nginx/sbin/nginx -c /etc/nginx/nginx.conf
    ExecReload=/bin/kill -s HUP $MAINPID
    ExecStop=/bin/kill -s TERM $MAINPID
    
    [Install]
    WantedBy=multi-user.target

（1.9.2）启动：

    sudo systemctl daemon-reload
    sudo systemctl reload nginx
    sudo systemctl enable nginx  # 启用开机自启
    sudo systemctl start nginx   # 启动Nginx服务
    systemctl status nginx #查看Nginx启动状态


### 十二.数据源druid

（1.1）官网：https://github.com/alibaba/druid


### 十三.Node.JS环境搭建：
（1）安装nvm：nvm是一个Node.js版本管理器。它的核心功能是帮你安装和管理多个不同版本的Node.js。

（1.1）官网：https://github.com/nvm-sh/nvm ；

（1.2）源码下载：
    
    cd ~
    git clone git@github.com:nvm-sh/nvm.git .nvm

（1.3）切到tag：

    cd .nvm
    git checkout v0.40.3

（1.4）激活并配置环境变量：

（1.4.1）激活nvm：
    
    source ~/.nvm/nvm.sh
    
（1.4.2）将环境变量配置添加到你的shell配置文件中（如 ~/.bashrc、~/.zshrc 等）：
    
    export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion

（1.4.3）使配置生效：
    source ./.bashrc

（1.5）配置nvm镜像（加速Node.js下载）
    
    新建：vim settings.txt
    node_mirror https://npmmirror.com/mirrors/node/  # Node.js二进制文件镜像
    npm_mirror https://npmmirror.com/mirrors/npm/    # npm包管理器镜像

（2）配置npm全局镜像（加速包下载）：npm是Node.js的包管理器。它伴随 Node.js 一起安装。它的核心功能是管理你项目中所需要的成千上万的第三方 JavaScript 库（也称为“包”或“依赖”），例如 vue、react、express、lodash 等

（2.1）设置淘宝镜像

    npm config set registry https://registry.npmmirror.com
（2.2）创建新目录:为全局包和缓存创建新的存放文件夹

    mkdir -p "$HOME/.nvm/node_global"
    mkdir -p "$HOME/.nvm/node_cache"
（2.3）配置新路径：通过npm命令设置新的全局安装路径和缓存路径

    npm config set prefix "$HOME/.nvm/node_global"
    npm config set cache "$HOME/.nvm/node_cache"
（2.4）设置 NODE_PATH：此变量告诉Node.js在哪里查找全局安装的模块
    
    export NODE_PATH="$HOME/.nvm/node_global/lib/node_modules"
（2.5）更新 PATH 变量：

    export PATH="$HOME/.nvm/node_global/bin:$PATH"
（2.6）使配置生效：

    source ~/.bashrc
（2.7）查看配置是否已更新：

    npm config list

（2.8）其他：使用 nrm 管理镜像源。如果你需要频繁切换不同的镜像源，可以安装 nrm (NPM Registry Manager) 这个便捷工具：
    npm install -g nrm
    nrm ls                           # 列出所有可用的镜像源
    nrm use taobao                   # 切换到淘宝镜像
    nrm test                         # 测试各个镜像源的响应速度

（3）安装node.js

（3.1）查看可安装的Node.js版本
    
    nvm ls-remote
    或
    nvm ls-remote --lts

（3.2）安装指定版本：

    nvm install v22.20.0

（3.3）使用多个node版本时：
    
    切换指定Node.js版本：nvm use v22.20.0
    或
    设置默认Node.js版本：nvm alias default v22.20.0


