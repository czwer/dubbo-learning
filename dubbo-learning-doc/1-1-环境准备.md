### 环境准备：

环境搭建时相关版本如下：

dubbo的版本为：dubbo-3.3.5-add-more-logging（基于tag:dubbo-3.3.5日志增强版本）

JDK版本：17

maven版本：3.9.11

gradle版本：8.14.3

spring版本：v6.2.7-add-more-logging（基于tag:v6.2.7日志增强版本）

zookeeper版本：3.9.3

dubbo admin版本：0.6.0-release

### 一.ubuntu下JDK安装

（1）下载bellsoft-jdk17.0.16，选择FULL JDK（Spring官网合作的JDK供应商，基于OPENJDK）：https://bell-sw.com/pages/downloads/#jdk-17-lts

    https://download.bell-sw.com/java/17.0.16+12/bellsoft-jdk17.0.16+12-linux-amd64-full.tar.gz
    https://download.bell-sw.com/java/21.0.8+12/bellsoft-jdk21.0.8+12-linux-amd64-full.tar.gz

（2）ubuntu下JDK多版本下使用：

（2.1）克隆jenv：git clone https://github.com/jenv/jenv.git ~/.jenv

（2.2）配置环境：

    echo 'export PATH="$HOME/.jenv/bin:$PATH"' >> ~/.bashrc
    echo 'eval "$(jenv init -)"' >> ~/.bashrc

（2.3）使.bashrc修改生效：source ~/.bashrc

（2.4）jenv加入openjdk-17的管理：

    tar -xzvf bellsoft-jdk17.0.16+12-linux-amd64-full.tar.gz
    tar -xzvf bellsoft-jdk21.0.8+12-linux-amd64-full.tar.gz
    jenv add /usr/lib/jvm/jdk-17.0.16-full
    jenv add /usr/lib/jvm/jdk-21.0.8-full

（2.5）切换JDK版本：jenv global 17


### 二.ubuntu下maven安装（dubbo使用）

（1）maven下载地址：https://dlcdn.apache.org/maven/maven-3/3.9.11/binaries/apache-maven-3.9.11-bin.zip

（2）ubuntu下maven多版本下使用：

（2.1）maven加入update-alternatives的管理：sudo update-alternatives --install /usr/bin/mvn mvn /xxx/apache-maven-3.9.11/bin/mvn 3911

（2.2）选择maven版本，输入选择这一列的编号：sudo update-alternatives --config mvn

### 三.ubuntu下安装gradle

（1）安装SDKMAN：
    
    curl -s "https://get.sdkman.io" | bash
    source "$HOME/.sdkman/bin/sdkman-init.sh"
    sdk list gradle
    sdk install gradle 8.14.3

### 四.spring：日志增强版本，以更好观察dubbo启动和运行过程

（1）在Spring官方fork到个人仓库：https://github.com/spring-projects/spring-framework

（2）git clone https://github.com/czwer/spring-framework.git

（3）切到目标tag：git checkout v6.2.7

（4）创建日志增强分支：git checkout -b v6.2.7-add-more-logging

    修改原来“6.2.7”版本号为：“6.2.7-add-more-logging”

（5）配置gradle：
    cp ~/.sdkman/tmp/gradle-8.14.zip gradle/wrapper/
    修改：gradle/wrapper/gradle-wrapper.properties中修改该行：distributionUrl=gradle-8.14.zip
    修改：gradle.properties中添加该行：org.gradle.java.installations.paths=/usr/lib/jvm/jdk-17.0.16-full,/usr/lib/jvm/jdk-21.0.8-full

（6）导入到 IDE（可选）

    生成 IDEA 配置文件
        ./gradlew idea
    生成 Eclipse 配置文件
        ./gradlew eclipse

（7）预编译 spring-oxm 模块（必须步骤）：

    ./gradlew :spring-oxm:compileTestJava

（8）完整编译：
    
    方式1: 跳过测试编译（推荐，节省时间）
        ./gradlew build -x test
    方式2: 并行编译（加快速度）
        ./gradlew build -x test --parallel

（9）部分编译：

    ./gradlew :spring-core:build

### 五.dubbo：日志增强版本，以更好观察duboo启动和运行过程

（1）在dubbo官方fork到个人仓库：https://github.com/apache/dubbo

（2）git clone https://github.com/czwer/dubbo.git

（3）切到目标tag：git checkout dubbo-3.3.5

（4）创建日志增强分支：git checkout -b dubbo-3.3.5-add-more-logging，新增的日志：“自定义日志-“

    修改原来“3.3.5”版本号为：“3.3.5-add-more-logging”：dubbo/pom.xml，dubbo-dependencies-bom/pom.xml中revision定义的版本
    如需修改spring-boot版本：3.5.0和spring版本：6.2.7，需要在dubbo/pom.xml中修改

（5）编译源码：

    如增加日志，先执行该指令：mvn spotless:apply
    跳过所有测试：mvn clean install -DskipTests
    或者跳过测试编译和执行：mvn clean install -Dmaven.test.skip=true
    编译指定模块：mvn clean compile -pl dubbo-config -Dmaven.test.skip=true

（6）构建所生成jar位置：
    
    dubbo/dubbo-distribution/dubbo-all/target/dubbo-3.3.5-add-more-logging.jar
    dubbo/dubbo-spring-boot-project/dubbo-spring-boot-starters/dubbo-spring-boot-starter/target/dubbo-spring-boot-starter-3.3.5-add-more-logging.jar
    
### 六.zookeeper安装

（1）zookeeper下载地址：https://dlcdn.apache.org/zookeeper/zookeeper-3.9.3/apache-zookeeper-3.9.3-bin.tar.gz

（2）拷贝配置：cp apache-zookeeper-3.9.3-bin/conf/zoo_sample.cfg apache-zookeeper-3.9.3-bin/conf/zoo.cfg

（3）创建数据目录和日志目录：

    mkdir apache-zookeeper-3.9.3-bin/data
    mkdir apache-zookeeper-3.9.3-bin/logs
（4）修改apache-zookeeper-3.9.3-bin/conf/zoo.cfg：

    dataDir=/xxx/apache-zookeeper-3.9.3-bin/data
    dataLogDir=/xxx/apache-zookeeper-3.9.3-bin/logs
（5）启动：

（5.1）前台启动：apache-zookeeper-3.9.3-bin/bin/zkServer.sh start-foreground

（5.2）后台启动：apache-zookeeper-3.9.3-bin/bin/zkServer.sh start

### 七.dubbo admin安装

（1）官网：https://github.com/apache/dubbo-admin

（2）dubbo admin下载：git clone https://github.com/apache/dubbo-admin.git

（2.1）切到分支：0.6.0-release

（2.2）修改dubbo-admin/dubbo-admin-server/pom.xml中zookeeper版本：3.7.2

    <groupId>org.apache.zookeeper</groupId>
    <artifactId>zookeeper</artifactId>
    <version>3.7.2</version>
（2.3）maven进行构建： mvn clean install -Dmaven.test.skip=true

（2.4）启动： java -jar dubbo-admin-server-0.6.0.jar

（3）访问地址：http://localhost:38080/#/ ，root/root

